sudo: required
os:
# Temporary disable CI on linux untils the electron-slim-linux is date out.
# - linux
- osx
dist: trusty
osx_image: xcode9.2
language: node_js
node_js:
- 'node'
matrix:
  allow_failures:
cache:
- apt: true
- directories:
  - "node_modules"
  - "$HOME/.electron"
before_install:
- bash test/ci/before_install.sh
install:
- npm install -g codecov
- npm install -g electron-mocha
- npm install
- npm update
before_script:
# Generate a virtual framebuffer X server to collect Electron windows
- export DISPLAY=:99.0
- if [ $TRAVIS_OS_NAME == "linux" ]; then sh -e /etc/init.d/xvfb start; sleep 3; fi
script:
#- xvfb-maybe node_modules/.bin/karma start test/unit/karma.conf.js
#- yarn run pack && xvfb-maybe node_modules/.bin/mocha test/e2e
# - if [ $TRAVIS_OS_NAME == "linux" ]; then xvfb-maybe npm run unit; else npm run unit; fi
- npm run unit
# - npm run e2e
- npm run build
deploy:
  provider: releases
  name: $TRAVIS_TAG
  api_key:
    secure: "ZQRZcheX5q/oc8OPvDo1R8As9nXDUEQR6mlhxe50uaJkc1SE04lBUnsCbQJul09OpN8Duo8xztGbPJrQcZVONdqObkP03/jEMhPes63XDWOs64QxYkHLGZGRlQI3FuAjDYfiCVnYopiwUSjm/PiiPK6dBfXB8dpYzYTJPe5PyhrsUUuRtRP8W1N2EfDhJYl7SD75Qrevqgco2ZLZ8G2FjT3Q/8CjXDeznCxwodwzsIn4rMaNFbGjLHiZ+nL+xave1GWTa8XqQq+/+HKu5iIW3a9AUqYAHNDblLQGljpY4n7jAobWFxL650u6J5DGy+n4C8POA7PV3j0t5ZyfhS54Y3h7SNpyinFRPE4kEPQTdVfKxhuagNw4smwXS9cij7KCZwwxhpP5mFBF9PemjLaB5uKZ2FywEhKiaCtbhIFbuy4o6WwECWYqBxQJ2OlXhMWF1rPj9WIgkaU9MsHqBIu91L7iH67L/KiyxHDU1PVtJ/M3IDo2aSLDj1ihH70gyWDnoZhkGPV4/DUqKuoxGU6CgKtyzI1EYKOLQ4tjcMeCGnGcHtTYhljNjxOEE6sXudZrhrG3TJONPadcp5evQ4twxacjxcNbFtW4CRnN1Eyn+0Oelzbb5h49r7dpwo3wbQMndPLgg5CErfSdRPNIdjs5nfkRJ/J+xienFuCon2+FSXI="
  file_glob: true
  overwrite: true
  github-token: 182981a70b41b783be24701519f9020fd276bc14
  file:
  - build/*.dmg
  - build/*.deb
  - build/*.rpm
  skip_cleanup: true
  on:
    tags: true
after_success:
- codecov
branches:
addons:
  apt:
    packages:
    - xvfb
env:
  global:
    # prevent wine popup dialogs about installing additional packages
    - WINEDLLOVERRIDES="mscoree,mshtml="
    - WINEDEBUG="-all"